<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ì˜µì…˜ â€” ë¹ ë¥¸ ìŠ¹ë¶€ìˆ˜ 4ì¢…</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css"/>
<style>
  :root{
    --bg:#0b0b0b; --ink:#e9e6df; --muted:#b8b1a2; --accent:#e6d9b6; --stroke:#ffffff22;
    --blur:1px; --grain:.10; --vig:.25; --sat:.98; --con:1.02; --crt:0; --shake:0;
    --subs-bg:0;   /* 0 none, 1 dark, 2 gold */
    --subs-size:16px;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:'Pretendard Variable',Pretendard,system-ui;overflow:hidden}

  /* Top bar */
  .top{
    position:fixed; inset:0 0 auto 0; height:56px; display:flex; align-items:center; gap:12px;
    padding:0 14px; background:linear-gradient(#0b0b0bcc,#0b0b0b80); border-bottom:1px solid var(--stroke); z-index:10;
  }
  .top h1{margin:0;font-size:15px;color:var(--accent);font-weight:800}
  .spacer{flex:1}
  select, .btn{
    background:#141414; color:#ddd; border:1px solid var(--stroke); border-radius:10px; height:36px; padding:0 10px;
  }
  .btn{cursor:pointer}
  .btn.primary{background:var(--accent);color:#000;border-color:var(--accent);font-weight:700}
  .btn:hover{filter:brightness(.95)}

  /* Layout */
  .wrap{position:fixed; inset:56px 0 0 0; display:grid; grid-template-columns: minmax(300px,1fr) 420px; gap:16px; padding:16px}
  .panel{background:#141414;border:1px solid var(--stroke);border-radius:14px}
  .left{position:relative;overflow:hidden}
  .preview{
    position:absolute; inset:0; background:#090909 center/cover no-repeat;
    filter: blur(var(--blur)) saturate(var(--sat)) contrast(var(--con));
  }
  .vignette::after{
    content:""; position:absolute; inset:0; pointer-events:none;
    background:radial-gradient(115% 90% at 50% 100%, rgba(0,0,0,calc(var(--vig)*.15)) 0%,
                                                   rgba(0,0,0,calc(var(--vig)*.45)) 60%,
                                                   rgba(0,0,0,calc(var(--vig)*.85)) 95%);
  }
  .crt{position:absolute; inset:0; opacity:calc(var(--crt)); background:repeating-linear-gradient(to bottom, rgba(255,255,255,.06), rgba(255,255,255,.06) 1px, transparent 2px); mix-blend-mode:overlay; pointer-events:none}
  .grain{position:absolute; inset:0; opacity:.15; mix-blend-mode:overlay; pointer-events:none; background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox=\"0 0 100 100\"><filter id=\"n\"><feTurbulence type=\"fractalNoise\" baseFrequency=\"0.8\" numOctaves=\"2\" stitchTiles=\"stitch\"/></filter><rect width=\"100%\" height=\"100%\" filter=\"url(%23n)\" opacity=\"0.65\"/></svg>'); background-size:220px 220px; animation:grain 1.6s steps(6,end) infinite}
  .shake{animation:shake .45s linear infinite}
  .tags{position:absolute; top:10px; right:10px; display:flex; gap:6px; z-index:2}
  .badge{padding:6px 10px; background:#0009; border:1px solid var(--stroke); border-radius:999px; font-size:12px}

  /* scene tabs */
  .tabs{position:absolute; left:10px; top:10px; display:flex; gap:8px; z-index:2}
  .tab{background:#0009; border:1px solid var(--stroke); color:#ddd; font-size:12px; height:32px; padding:0 10px; border-radius:999px; cursor:pointer}
  .tab.active{background:var(--accent); color:#000; border-color:var(--accent)}

  /* subtitle sample */
  .subs{
    position:absolute; left:50%; bottom:24px; transform:translateX(-50%);
    padding:6px 12px; border-radius:8px; font-size:var(--subs-size); line-height:1.5; text-align:center; z-index:2;
    background: transparent; color:#eee; border:1px solid transparent;
  }
  .subs.bg-dark{background:#000000a6; border-color:#ffffff22}
  .subs.bg-gold{background:#463c22b0; border-color:#bda869}
  .controls{position:absolute; right:10px; bottom:10px; display:flex; gap:8px; z-index:2}
  .ghost{background:#0000; border:1px solid var(--stroke); color:#ddd; padding:8px 12px; border-radius:10px; cursor:pointer}
  .ghost:hover{background:#1b1b1b}

  /* right panels */
  .right{display:flex; flex-direction:column; gap:12px}
  .card{padding:14px 14px 12px}
  .card h2{margin:0 0 8px; font-size:16px; color:var(--accent)}
  .row{display:flex; align-items:center; gap:10px; margin:8px 0}
  .row label{width:130px; color:#dcd6c6; font-size:13px}
  input[type="range"]{flex:1}

  /* safety modal */
  .modal{position:fixed; inset:0; display:none; place-items:center; background:#000000c8; z-index:20}
  .modal[open]{display:grid}
  .sheet{width:min(520px,92vw); background:#151515; border:1px solid var(--stroke); border-radius:14px; padding:16px}
  .sheet h3{margin:0 0 6px; color:var(--accent)}
  .sheet p{margin:8px 0; color:#cfc8b8}
  .sheet .actions{display:flex; justify-content:flex-end; gap:8px; margin-top:10px}

  /* animations */
  @keyframes grain{0%{transform:translate(0,0)}25%{transform:translate(-2%,1%)}50%{transform:translate(1%,-1%)}75%{transform:translate(2%,2%)}100%{transform:translate(0,0)}}
  @keyframes shake{0%,100%{transform:translate(0,0)}20%{transform:translate(1px,-1px)}40%{transform:translate(-1px,2px)}60%{transform:translate(2px,1px)}80%{transform:translate(-2px,-1px)}}
  @media (prefers-reduced-motion:reduce){
    .grain,.shake{animation:none!important}
  }
</style>
</head>
<body>

<!-- Top bar -->
<div class="top">
  <h1>ì˜µì…˜ Â· ê°ê° ì½˜ì†”</h1>
  <div class="spacer"></div>
  <label for="preset" style="font-size:12px;color:#dcd6c6">í”„ë¦¬ì…‹</label>
  <select id="preset">
    <option value="normal">ë…¸ë©€</option>
    <option value="dream">ê¿ˆì†</option>
    <option value="collapse">í˜„ì‹¤ ë¶•ê´´</option>
    <option value="custom">ì‚¬ìš©ì ì •ì˜</option>
  </select>
  <button class="btn" id="btnRevert">ë˜ëŒë¦¬ê¸°</button>
  <button class="btn primary" id="btnApply">ì ìš©</button>
</div>

<div class="wrap">
  <!-- LEFT: Preview -->
  <section class="panel left">
    <div class="tabs">
      <button class="tab active" data-scene="close">ì¸ë¬¼ ê·¼ì ‘</button>
      <button class="tab" data-scene="night">ì•¼ì™¸ ì–´ë‘ </button>
      <button class="tab" data-scene="text">í…ìŠ¤íŠ¸ í™”ë©´</button>
    </div>

    <div class="tags">
      <div class="badge" id="tagPreset">ë…¸ë©€</div>
      <div class="badge" id="tagStatus">ì™œê³¡ 25 Â· ê°ì • OFF</div>
    </div>

    <div class="preview vignette" id="preview"></div>
    <div class="crt" id="crt"></div>
    <div class="grain"></div>

    <div class="subs" id="subs">â€œì—¬ê¸´â€¦ ì–´ë””ì§€?â€</div>

    <div class="controls">
      <button class="ghost" id="btnTest">ê¸°ì–µ ë³µì› 3ì´ˆ í…ŒìŠ¤íŠ¸</button>
    </div>
  </section>

  <!-- RIGHT: Controls -->
  <aside class="right">
    <div class="panel card">
      <h2>ğŸ§ ëª°ì…</h2>
      <div class="row">
        <label>CRT/ë…¸ì´ì¦ˆ</label>
        <input id="crtRange" type="range" min="0" max="100" value="0"/>
      </div>
      <div class="row">
        <label>í”ë“¤ë¦¼</label>
        <input id="shakeRange" type="range" min="0" max="100" value="0"/>
      </div>
      <div class="row">
        <label>ì±„ë„/ëŒ€ë¹„</label>
        <input id="satRange" type="range" min="70" max="130" value="98"/>
        <input id="conRange" type="range" min="95" max="120" value="102"/>
      </div>
      <div class="row">
        <label>ë¹„ë„¤íŒ…</label>
        <input id="vigRange" type="range" min="0" max="80" value="25"/>
      </div>
    </div>

    <div class="panel card">
      <h2>ğŸ’“ ê°ì • í”¼ë“œë°±</h2>
      <div class="row">
        <label>í™œì„±í™”</label>
        <input id="emotionToggle" type="checkbox"/>
      </div>
      <p style="color:#cbbfa6;font-size:12px">ëª¨ì…˜ ë¯¼ê° ëª¨ë“œê°€ ê°ì§€ë˜ë©´ ìë™ìœ¼ë¡œ OFFë©ë‹ˆë‹¤.</p>
    </div>

    <div class="panel card">
      <h2>ğŸ§° ê°œì¸í™” Â· ì ‘ê·¼ì„±</h2>
      <div class="row">
        <label>ìë§‰ ê¸€ì í¬ê¸°</label>
        <input id="sizeRange" type="range" min="12" max="24" value="16"/>
      </div>
      <div class="row">
        <label>ìë§‰ ë°°ê²½</label>
        <select id="bgSelect">
          <option value="0">ì—†ìŒ</option>
          <option value="1">ì•”ìƒ‰(ê°€ë…â†‘)</option>
          <option value="2">í™©ê¸ˆí†¤</option>
        </select>
      </div>
    </div>

    <div class="panel card">
      <h2>â„¹ï¸ ì•ˆë‚´</h2>
      <p style="color:#cbbfa6;font-size:13px">â€œí˜„ì‹¤ ë¶•ê´´â€ í”„ë¦¬ì…‹ì—ì„œëŠ” ì¼ë¶€ ì¥ë©´ì—ì„œ í™”ë©´ì´ ë¶ˆì•ˆì •í•˜ê²Œ ë³´ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </div>
  </aside>
</div>

<!-- Safety Modal -->
<div class="modal" id="safety">
  <div class="sheet">
    <h3>ê°ì • í”¼ë“œë°± ê²½ê³ </h3>
    <p>ê°ì • í”¼ë“œë°±ì€ ê°•í•œ ì‹œê°/ì²­ê° ìê·¹ì„ ìœ ë°œí•  ìˆ˜ ìˆì–´ìš”. ë¶ˆí¸í•˜ë©´ ì–¸ì œë“  OFF í•˜ì„¸ìš”.</p>
    <div class="actions">
      <button class="btn" id="keepOff">OFF ìœ ì§€</button>
      <button class="btn primary" id="turnOn">ê³„ì†(ON)</button>
    </div>
  </div>
</div>

<script>
  // ---- State
  const state = {
    preset: 'normal',
    crt: 0, shake: 0, sat: 98, con: 102, vig: 25,
    emotion: false, subsBg: 0, subsSize: 16,
    scene: 'close'
  };
  let applied = {...state}; // ë˜ëŒë¦¬ê¸°ìš© ë§ˆì§€ë§‰ ì ìš©ë³¸

  // ---- Elements
  const $preview = document.getElementById('preview');
  const $crt = document.getElementById('crt');
  const $subs = document.getElementById('subs');
  const $tagPreset = document.getElementById('tagPreset');
  const $tagStatus = document.getElementById('tagStatus');

  // controls
  const $preset = document.getElementById('preset');
  const $btnApply = document.getElementById('btnApply');
  const $btnRevert = document.getElementById('btnRevert');
  const $crtRange = document.getElementById('crtRange');
  const $shakeRange = document.getElementById('shakeRange');
  const $satRange = document.getElementById('satRange');
  const $conRange = document.getElementById('conRange');
  const $vigRange = document.getElementById('vigRange');
  const $emotionToggle = document.getElementById('emotionToggle');
  const $sizeRange = document.getElementById('sizeRange');
  const $bgSelect = document.getElementById('bgSelect');
  const $btnTest = document.getElementById('btnTest');
  const $safety = document.getElementById('safety');

  // scenes
  const sceneBG = {
    close: 'image.png',
    night: 'ì¸ë¬¼.jpg',
    text:  'text.jpg'
  };

  // ---- Presets
  const PRESETS = {
    normal:  {crt:0,  shake:0,  sat:98, con:102, vig:25, label:'ë…¸ë©€'},
    dream:   {crt:30, shake:0,  sat:106,con:105, vig:42, label:'ê¿ˆì†'},
    collapse:{crt:55, shake:100,sat:85, con:112, vig:55, label:'í˜„ì‹¤ ë¶•ê´´'},
    custom:  null
  };

  function applyPreset(name){
    state.preset = name;
    if(name !== 'custom'){
      const p = PRESETS[name];
      state.crt=p.crt; state.shake=p.shake; state.sat=p.sat; state.con=p.con; state.vig=p.vig;
      // sync sliders
      $crtRange.value=p.crt; $shakeRange.value=p.shake; $satRange.value=p.sat; $conRange.value=p.con; $vigRange.value=p.vig;
      render();
    }
    $tagPreset.textContent = PRESETS[name]?.label || 'ì‚¬ìš©ì ì •ì˜';
  }

  // ---- Render
  function render(){
    document.documentElement.style.setProperty('--crt', state.crt/100);
    document.documentElement.style.setProperty('--vig', state.vig/100);
    document.documentElement.style.setProperty('--sat', state.sat/100);
    document.documentElement.style.setProperty('--con', state.con/100);
    document.documentElement.style.setProperty('--shake', state.shake>0?1:0);

    $crt.style.opacity = state.crt/100;
    $preview.classList.toggle('shake', state.shake>0);
    $preview.style.backgroundImage = `url('${sceneBG[state.scene]}')`;

    // subtitles
    document.documentElement.style.setProperty('--subs-size', state.subsSize+'px');
    $subs.classList.remove('bg-dark','bg-gold');
    if(state.subsBg==1) $subs.classList.add('bg-dark');
    if(state.subsBg==2) $subs.classList.add('bg-gold');

    $tagStatus.textContent = `ì™œê³¡ ${state.vig} Â· ê°ì • ${state.emotion?'ON':'OFF'}`;
  }

  // ---- Bindings
  document.querySelectorAll('.tab').forEach(btn=>{
    btn.addEventListener('click',()=>{
      document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      state.scene = btn.dataset.scene;
      render();
    });
  });

  $preset.addEventListener('change', e=> applyPreset(e.target.value));
  $crtRange.addEventListener('input', e=>{ state.crt=+e.target.value; state.preset='custom'; render(); $preset.value='custom'; });
  $shakeRange.addEventListener('input', e=>{ state.shake=+e.target.value; state.preset='custom'; render(); $preset.value='custom'; });
  $satRange.addEventListener('input', e=>{ state.sat=+e.target.value; state.preset='custom'; render(); $preset.value='custom'; });
  $conRange.addEventListener('input', e=>{ state.con=+e.target.value; state.preset='custom'; render(); $preset.value='custom'; });
  $vigRange.addEventListener('input', e=>{ state.vig=+e.target.value; state.preset='custom'; render(); $preset.value='custom'; });

  // emotion safety
  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  if(prefersReducedMotion){ $emotionToggle.checked=false; state.emotion=false; }
  $emotionToggle.addEventListener('change', e=>{
    if(e.target.checked){
      if(prefersReducedMotion){
        // ìë™ ì°¨ë‹¨ ì•Œë¦¼
        e.target.checked=false; state.emotion=false;
        openSafety('ì‹œìŠ¤í…œì—ì„œ ëª¨ì…˜ ìµœì†Œí™”ê°€ ì„¤ì •ë˜ì–´ ìˆì–´ ê°ì • í”¼ë“œë°±ì„ ìë™ìœ¼ë¡œ OFFí–ˆìŠµë‹ˆë‹¤.');
      }else{
        openSafety();
      }
    }else{
      state.emotion=false;
      render();
    }
  });
  function openSafety(msg){
    if(msg) $safety.querySelector('p').textContent = msg;
    $safety.setAttribute('open','');
  }
  document.getElementById('keepOff').onclick = ()=>{ state.emotion=false; $emotionToggle.checked=false; $safety.removeAttribute('open'); render(); };
  document.getElementById('turnOn').onclick  = ()=>{ state.emotion=true;  $emotionToggle.checked=true;  $safety.removeAttribute('open'); render(); };

  // personalization
  $sizeRange.addEventListener('input', e=>{ state.subsSize=+e.target.value; render(); });
  $bgSelect.addEventListener('change', e=>{ state.subsBg=+e.target.value; render(); });

  // apply / revert
  $btnApply.addEventListener('click', ()=>{
    applied = {...state};
    alert('ì„¤ì •ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤.');
  });
  $btnRevert.addEventListener('click', ()=>{
    state.preset = applied.preset;
    Object.assign(state, applied);
    // sync UI
    $preset.value=state.preset;
    $crtRange.value=state.crt; $shakeRange.value=state.shake; $satRange.value=state.sat; $conRange.value=state.con; $vigRange.value=state.vig;
    $emotionToggle.checked=state.emotion; $sizeRange.value=state.subsSize; $bgSelect.value=state.subsBg;
    render();
  });

  // memory restore 3s test
  let testing=false;
  $btnTest.addEventListener('click', ()=>{
    if(testing) return;
    testing=true;
    const old = { ...state };
    // 3ì´ˆ ë™ì•ˆ ì™œê³¡/CRT/í”ë“¤ë¦¼ ê°•í•˜ê²Œ
    state.crt = Math.max(state.crt, 60);
    state.vig = Math.max(state.vig, 60);
    state.shake = 100;
    render();
    setTimeout(()=>{
      Object.assign(state, old);
      render();
      testing=false;
    }, 3000);
  });

  // init
  applyPreset('normal');
  render();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ENDING C — 마지막 선택</title>

  <!-- 폰트 -->
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css"/>

  <style>
    :root{
      --bg:#040307;
      --bg2:#120815;
      --ink:#f5f0e6;
      --muted:#b8a9a0;

      /* ENDING C (EXIT / RELEASE) */
      --accent:#ff7f7f;
      --accent-soft:#ffb3a0;
      --accent-deep:#ff4b4b;

      --stroke:#ffffff22;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(circle at 0% 0%, #4a1e28 0, #050307 40%, #020103 100%);
      color:var(--ink);
      font-family:'Pretendard Variable',Pretendard,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    .page{
      width:min(1040px, 96vw);
      max-height:94vh;
      border-radius:22px;
      border:1px solid var(--stroke);
      background:
        radial-gradient(circle at 0% 0%, #482128 0, #0a050d 45%, #050308 100%);
      box-shadow:
        0 28px 90px rgba(0,0,0,.9),
        0 0 42px rgba(255,100,100,.18);
      padding:26px clamp(22px,3.5vw,32px) 22px;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }

    /* ===== 상단 헤더 ===== */
    .page-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:18px;
      margin-bottom:18px;
    }
    .brand-title{
      font-size:clamp(20px,2.6vw,26px);
      letter-spacing:.42em;
      text-indent:.42em;
      font-weight:800;
      color:var(--accent-soft);
      text-shadow:0 0 18px rgba(255,150,150,.85);
      white-space:nowrap;
    }
    .brand-sub{
      margin-top:4px;
      font-size:.76rem;
      letter-spacing:.2em;
      text-transform:uppercase;
      color:var(--muted);
    }
    .meta-right{
      text-align:right;
      font-size:.75rem;
      letter-spacing:.16em;
      text-transform:uppercase;
      color:var(--muted);
    }
    .meta-right .hl{
      margin-top:4px;
      color:var(--accent-soft);
    }

    /* ===== 본문 레이아웃 ===== */
    .body-grid{
      flex:1;
      display:grid;
      grid-template-columns: minmax(0,2.1fr) minmax(0,1.6fr);
      gap:18px;
      padding:20px clamp(18px,3vw,26px);
      border-radius:16px;
      border:1px solid #ffffff1f;
      background:radial-gradient(circle at 15% 0%, #3a2624 0, #120910 38%, #070509 100%);
      overflow:auto;
    }

    /* 왼쪽 메인 */
    .eyebrow{
      font-size:.78rem;
      letter-spacing:.28em;
      text-transform:uppercase;
      color:var(--muted);
      margin-bottom:4px;
    }
    h1{
      margin:0 0 4px;
      font-size:1.6rem;
      color:var(--accent);
    }
    .status-line{
      font-size:.8rem;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:#e2d2c9;
      margin-bottom:14px;
    }
    .status-line span{
      color:var(--accent-soft);
    }

    .summary{
      font-size:.96rem;
      line-height:1.9;
      color:var(--ink);
    }
    .summary p{margin:.45em 0;}
    .summary p.lead{
      font-size:1.02rem;
      color:#f9efe3;
    }

    /* 하이라이트 대사 */
    .quote-block{
      margin-top:16px;
      padding:10px 14px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.18);
      background:linear-gradient(135deg,rgba(0,0,0,.4),rgba(120,40,40,.45));
      font-size:.95rem;
      line-height:1.8;
      position:relative;
      color:#ffe8e2;
    }
    .quote-block::before{
      content:"“";
      position:absolute;
      left:10px;
      top:2px;
      font-size:1.6rem;
      color:var(--accent-soft);
      opacity:.6;
    }

    /* 선택 타임라인 */
    .route-box{
      margin-top:18px;
      padding:12px 14px;
      border-radius:12px;
      border:1px dashed rgba(255,255,255,.22);
      background:radial-gradient(circle at 0 0,rgba(255,255,255,.06) 0,rgba(0,0,0,.2) 55%);
      font-size:.88rem;
      color:var(--muted);
    }
    .route-box-title{
      font-size:.8rem;
      letter-spacing:.22em;
      text-transform:uppercase;
      color:var(--accent-soft);
      margin-bottom:6px;
    }

    .route-timeline{
      list-style:none;
      margin:8px 0 6px;
      padding:0;
      position:relative;
    }
    .route-timeline::before{
      content:"";
      position:absolute;
      left:10px;
      top:4px;
      bottom:4px;
      width:1px;
      background:linear-gradient(to bottom,rgba(255,255,255,.35),rgba(255,255,255,.05));
    }
    .route-step{
      position:relative;
      padding-left:26px;
      margin:6px 0;
    }
    .route-step::before{
      content:"";
      position:absolute;
      left:6px;
      top:6px;
      width:8px;height:8px;
      border-radius:50%;
      background:radial-gradient(circle,#fff 0,var(--accent) 45%,#e03030 100%);
      box-shadow:0 0 8px rgba(255,120,120,.8);
    }
    .route-step-label{
      font-size:.78rem;
      text-transform:uppercase;
      letter-spacing:.16em;
      color:#e7d5cf;
      margin-bottom:1px;
    }
    .route-step-text{
      font-size:.86rem;
      color:#cfc0b7;
      word-break:break-word;
    }

    .route-desc{
      margin-top:8px;
      font-size:.86rem;
    }
    .route-desc strong{color:var(--accent-soft);}
    .clear-count{
      margin-top:4px;
      font-size:.8rem;
      color:#e3c3c0;
    }

    /* 오른쪽 사이드 박스들 */
    .side-column{
      display:flex;
      flex-direction:column;
      gap:10px;
      font-size:.9rem;
    }
    .side-box{
      border-radius:12px;
      border:1px solid rgba(255,255,255,.16);
      background:radial-gradient(circle at 0 0,rgba(255,255,255,.04) 0,rgba(0,0,0,.4) 55%);
      padding:10px 12px 12px;
    }
    .side-title{
      font-size:.82rem;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:var(--accent-soft);
      margin-bottom:4px;
    }
    .side-body{
      font-size:.9rem;
      line-height:1.7;
      color:#e7d9d2;
    }
    .side-body ul{
      margin:6px 0 0;
      padding-left:18px;
    }
    .side-body li{margin:4px 0;}

    /* 장면/사운드 note 강조 */
    .side-box.scene{
      border-color:rgba(255,130,130,.55);
      box-shadow:0 0 22px rgba(255,90,90,.18);
    }

    /* ===== 하단 버튼 ===== */
    .footer{
      margin-top:14px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .btn-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .btn{
      border-radius:999px;
      padding:8px 18px;
      font-size:.85rem;
      letter-spacing:.04em;
      cursor:pointer;
      border:1px solid #ffffff33;
      background:transparent;
      color:var(--ink);
      display:inline-flex;
      align-items:center;
      gap:6px;
      text-decoration:none;
    }
    .btn.primary{
      background:var(--accent-deep);
      border-color:var(--accent-deep);
      color:#1b0d0b;
      font-weight:600;
    }
    .btn span.icon{
      font-size:.9rem;
    }
    .btn:hover{
      border-color:var(--accent-soft);
      box-shadow:0 0 18px rgba(255,150,150,.45);
    }
    .foot-note{
      font-size:.78rem;
      color:var(--muted);
    }

    @media (max-width:780px){
      body{padding:12px;}
      .page{padding:18px;}
      .body-grid{grid-template-columns:1fr;}
      .meta-right{text-align:left;}
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- 상단 헤더 -->
    <header class="page-header">
      <div>
        <div class="brand-title">BANDERSNATCH</div>
        <div class="brand-sub">ENDING ARCHIVE</div>
      </div>
      <div class="meta-right">
        <div>INTERACTIVE NOVEL</div>
        <div class="hl">ENDING C · EXIT ROUTE</div>
      </div>
    </header>

    <!-- 메인 컨텐츠 -->
    <section class="body-grid">
      <!-- 왼쪽 메인 -->
      <div>
        <div class="eyebrow">ENDING C</div>
        <h1>마지막 선택</h1>
        <p class="status-line">
          STATUS · UNLOCKED · ROUTE DEPTH : <span id="routeDepth">0</span>
        </p>

        <div class="summary">
          <p class="lead">
            당신은 이 이야기를 더 이상 ‘보기만 하는’ 상태로 두지 않기로 결정한다.
            계속 쫓아가느냐, 스스로 멈추느냐 사이에서 처음으로 명확하게 <strong>멈춤</strong>을 택한다.
          </p>
          <p>
            수많은 링크와 영상, 기사와 증언이 아직 남아 있지만,
            오늘 밤 당신이 내린 선택은 “모두 읽는 것”이 아니라
            “어디까지 읽을지 스스로 정하는 것”에 가깝다.
          </p>
          <p>
            브라우저를 닫는다고 해서 사건이 사라지는 것은 아니다.
            사건은 여전히 어딘가에서 계속해서 언급되고, 논쟁되고, 소비될 것이다.
            하지만 적어도 이 화면 앞의 당신만큼은, 이 이야기가
            자신의 정신과 시간을 잠식하게 두지 않겠다고 결정했다.
          </p>
          <p>
            이 엔딩은 가장 화려한 결말은 아닐지 모른다.
            누군가에겐 ‘도망’처럼 보일 수도 있다.
            그러나 이야기에서 빠져나오는 것도, 그 이야기 안에서
            어떤 선택을 하는 것만큼이나 중요한 선택이라는 사실을
            당신은 이미 알고 있다.
          </p>
          <p>
            언젠가 다시 돌아오게 된다 해도, 오늘의 이 종료는 기록으로 남는다.
            “여기서 한 번 숨을 고르기로 했다”는 문장 하나가,
            이후의 모든 재생과 재시작을 조금은 다르게 만들 것이다.
          </p>
        </div>

        <!-- 하이라이트 대사 -->
        <div class="quote-block" id="quoteLine">
          여기서 멈추자. — 끝내는 것도, 선택이다.
        </div>

        <!-- 선택 타임라인 + 요약 + 클리어 카운트 -->
        <section class="route-box">
          <div class="route-box-title">ROUTE LOG · 당신이 밟아온 선택들</div>
          <ul class="route-timeline" id="routeTimeline"></ul>
          <p class="route-desc" id="routeSummary"></p>
          <p class="clear-count" id="clearCount"></p>
        </section>
      </div>

      <!-- 오른쪽 사이드 정보 -->
      <aside class="side-column">
        <!-- 장면/사운드 연출 노트 -->
        <section class="side-box scene">
          <div class="side-title">SCENE / SOUND NOTE</div>
          <div class="side-body">
            <p>
              화면 전체가 서서히 어두워지며, 배경의 붉은 기가 사라지고 검정으로 수렴한다.
              UI 요소들은 하나둘씩 비활성화되고, 클릭 가능한 버튼만 최소로 남는다.
            </p>
            <p>
              마지막 문장을 읽는 순간, 모든 효과음이 끊기고
              짧은 잔향(ambient)만 남은 채 <em>한 번의 페이드 아웃</em>으로 화면이 정리된다.
            </p>
          </div>
        </section>

        <!-- 이 엔딩의 의미 -->
        <section class="side-box">
          <div class="side-title">WHAT THIS ENDING MEANS</div>
          <div class="side-body">
            <p>
              ENDING C는 <strong>진실을 끝까지 파헤치는 결말</strong>이 아니라,
              <strong>내가 감당할 수 있는 선을 정하는 결말</strong>이다.
            </p>
            <p>
              “계속 보기”를 멈추는 순간, 플레이어는 처음으로 이야기의 바깥에서도
              선택을 할 수 있다는 걸 깨닫는다.
            </p>
          </div>
        </section>

        <!-- 선택 해석 / 키 선택 -->
        <section class="side-box">
          <div class="side-title">YOUR KEY CHOICES</div>
          <div class="side-body">
            <ul id="keyChoices"></ul>
          </div>
        </section>
      </aside>
    </section>

    <!-- 하단 버튼 -->
    <footer class="footer">
      <div class="btn-row">
        <button class="btn primary" onclick="location.href='Start.html'">
          <span class="icon">↺</span>
          처음부터 다시 시작
        </button>
        <a class="btn" href="지난선택.html">
          <span class="icon">☷</span>
          지난 선택 보기
        </a>
        <a class="btn" href="endings.html">
          <span class="icon">✦</span>
          엔딩 모음집
        </a>
      </div>
      <p class="foot-note">
        이 엔딩을 보면 <strong>ENDING C</strong>가 자동으로 해금되며,
        <em>지난 선택</em> 화면과 <em>엔딩 모음집</em>에서 확인할 수 있습니다.
      </p>
    </footer>
  </div>

  <script>
    // URL 파라미터 읽기
    function getParam(name){
      const params = new URLSearchParams(location.search);
      return params.get(name);
    }

    // 첫번째 텍스트파일 로직 유지: path는 선택할 때마다 누적될 수 있음 (길어도 OK)
    function normalizePath(raw){
      return (raw || '')
        .toUpperCase()
        .replace(/[^AB]/g, '');
    }

    // (선택) A/B를 사람이 읽는 문장으로 바꾸고 싶으면 수정
    // 예) const LABEL = { A: "기록을 더 본다", B: "창을 닫는다" };
    const LABEL = null;

    const ROUTE_INTERPRET = {
      'AA': {
        summary: '같은 방향으로 두 번 연속 밀어붙인 끝에, 당신은 “끝까지 보기”가 아니라 “여기서 멈추기”를 선택했습니다.',
        choices: [
          '호기심을 따라 더 깊이 들어갔다.',
          '하지만 마지막에 스스로 브레이크를 걸었다.',
          '‘끝내기’로 통제권을 되찾았다.'
        ]
      },
      'AB': {
        summary: '한 번은 따라가고, 한 번은 멈춘 루트입니다. 당신은 끝까지 쫓는 대신, 적절한 순간에 화면 밖으로 나올 줄 압니다.',
        choices: [
          '정보를 확인하되 과몰입은 피했다.',
          '경계선을 넘기 직전에 멈췄다.',
          '‘나를 지키는 선택’을 우선했다.'
        ]
      },
      'BA': {
        summary: '처음에는 거리를 두려 했지만, 결국 한 번 더 확인하고 싶었습니다. 그 확인 끝에 당신은 종료를 선택합니다.',
        choices: [
          '처음엔 거리 두기를 시도했다.',
          '하지만 다시 한 번 확인했다.',
          '그리고 스스로 마무리를 눌렀다.'
        ]
      },
      'BB': {
        summary: '계속 피하려 했던 흐름이, 오히려 가장 빠르게 “종료”로 이어졌습니다. 당신에게 중요한 건 결말보다 안전한 탈출구였습니다.',
        choices: [
          '위험해 보이는 지점을 피했다.',
          '멈추는 선택을 반복했다.',
          '결말보다 회복을 택했다.'
        ]
      }
    };

    document.addEventListener('DOMContentLoaded', () => {
      // 해금
      try{ localStorage.setItem('ending:ENDING_C','1'); }catch(e){}

      // 클리어 카운트
      const keyCount = 'ending:ENDING_C_count';
      let count = 0;
      try{
        count = parseInt(localStorage.getItem(keyCount) || '0', 10);
        count++;
        localStorage.setItem(keyCount, String(count));
      }catch(e){}

      const clearCountEl = document.getElementById('clearCount');
      if(clearCountEl){
        if(count <= 1){
          clearCountEl.textContent = '이번이 이 엔딩에 처음 도달한 기록입니다.';
        }else{
          clearCountEl.textContent = `지금까지 이 엔딩에 도달한 횟수: ${count}회`;
        }
      }

      // path 처리
      const fullPath = normalizePath(getParam('path'));
      const depth = fullPath.length;

      const depthEl = document.getElementById('routeDepth');
      if(depthEl) depthEl.textContent = String(depth);

      // 타임라인 채우기 (path 전체를 그대로)
      const listEl = document.getElementById('routeTimeline');
      if(listEl){
        if(!fullPath){
          listEl.innerHTML = '<li class="route-step"><div class="route-step-label">NO LOG</div><div class="route-step-text">선택 기록이 없습니다. (path 파라미터가 비어있음)</div></li>';
        }else{
          listEl.innerHTML = fullPath.split('').map((ch, i) => {
            const label = (LABEL && LABEL[ch]) ? LABEL[ch] : ch;
            return `
              <li class="route-step">
                <div class="route-step-label">CHOICE ${i+1}</div>
                <div class="route-step-text">${label}</div>
              </li>
            `;
          }).join('');
        }
      }

      // route 해석 (마지막 2개의 선택을 기준으로)
      const key = (depth >= 2) ? fullPath.slice(-2) : (depth === 1 ? (fullPath + fullPath) : 'AB');
      const data = ROUTE_INTERPRET[key] || ROUTE_INTERPRET['AB'];

      const summaryEl = document.getElementById('routeSummary');
      if(summaryEl){
        if(fullPath){
          const pretty = fullPath.split('').join(' → ');
          summaryEl.innerHTML = `이번 플레이에서 당신은 <strong>${pretty}</strong> 순서로 선택해 이 엔딩에 도달했습니다.<br/>${data.summary}`;
        }else{
          summaryEl.textContent = data.summary;
        }
      }

      const keyChoices = document.getElementById('keyChoices');
      if(keyChoices){
        keyChoices.innerHTML = '';
        for(const item of data.choices){
          const li = document.createElement('li');
          li.textContent = item;
          keyChoices.appendChild(li);
        }
      }
    });
  </script>
</body>
</html>
